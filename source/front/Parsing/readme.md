# 语法分析模块

Tastror updated in 2022.5.18

## 综述

语法分析采用 FIRST 标记符号的自顶向下分析法。因为 SysY 的语言大多一个 FIRST 符就够了，所以非常舒服。

| :warning:**WARNING**：仅仅在赋值语句中向后搜索了是否存在 `=`，在一个有大量表达式的数组赋值中，也许会影响性能。 |
| ------------------------------------------------------------ |

具体语法树的类型请查看 `define.h` 中 AST 部分。

语法分析的结构相较符号表而言相对简单，自己看就好。

唯一值得注意的是，整个词法 token 在 AST 中只增不减，并且用且仅用 GoNext(); 向后推进一格。为了表示强调，这里的 now_token 没有用 static，而是在每个位置手动传一下。不过使用 static 会方便，不知是否需要改进。

## 符号表

符号表在 AST 生成的同时生成。

符号表由符号节点组成的链表构成，同时，符号表保存了可见域的符号链（比如 if 的条件内的符号表，符号链包括了外侧 main 函数和外侧静态区）。

符号表的头（一个无具体数据的符号节点）除了用来表示符号表的开始，也用来向上或者向下传递属性。

如果需要一个符号表存在子符号表，则需要在 AST 的构造函数第二项新建一个符号表并用 extend_from 继承母符号表。

两个 static

- 为了保证唯一性，加入了符号表的计数（符号节点在 append 入符号表时自动加入一个计数前缀；head 节点也会在构建时获取计数器前缀，同时也只有 head 需要显式地使用 rename）；
- 为了方便 debug，加入了符号表的全表头向量。





















